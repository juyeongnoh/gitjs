# gitjs

í•œêµ­ì–´ | [English](https://github.com/juyeongnoh/gitjs/blob/main/README-en.md)

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ

Node.jsì˜ fs ëª¨ë“ˆê³¼ Bufferë¥¼ í™œìš©í•˜ì—¬, Gitì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ ë°”ë‹¥ë¶€í„° ì§ì ‘ êµ¬í˜„í•´ë³´ë©° í•™ìŠµ

## ğŸƒ ì‹¤í–‰í•˜ê¸°

```bash
$ git clone https://github.com/juyeongnoh/gitjs
$ cd gitjs
$ touch test.txt
$ node index

init                   // git ì €ì¥ì†Œ ì´ˆê¸°í™”
add test.txt           // test1.txt ìŠ¤í…Œì´ì§•
print-index            // í˜„ì¬ ìŠ¤í…Œì´ì§• ì˜ì—­ ìƒíƒœ ì¡°íšŒ
commit my first commit // "my first commit"ì´ë¼ëŠ” ì»¤ë°‹ ìƒì„±
cat-file <hash>        // git object ì—´ëŒ
branch -c my-branch    // my-branch ìƒì„±
branch -d my-branch    // my-branch ì‚­ì œ
```

## ğŸ’» êµ¬í˜„ ë‚´ìš©

### Porcelains (git ëª…ë ¹ì–´)

- init ëª…ë ¹ì–´ ([/porcelains/init.js](https://github.com/juyeongnoh/gitjs/blob/main/porcelains/init.js))
  - git ì €ì¥ì†Œì˜ ê¸°ë³¸ ì¡°ê±´ (`/objects`, `/refs`, `HEAD`, `index`) ìƒì„±
- add ëª…ë ¹ì–´ ([/porcelains/add.js](https://github.com/juyeongnoh/gitjs/blob/main/porcelains/add.js))
  - íŒŒì¼ ì¶”ê°€ ì‹œ blob ì˜¤ë¸Œì íŠ¸ ìƒì„±
  - ìŠ¤í…Œì´ì§• ì˜ì—­(Index)ì— íŒŒì¼ ì´ë¦„ ìˆœì„œëŒ€ë¡œ ì¶”ê°€
- commit ëª…ë ¹ì–´ ([/porcelains/commit.js](https://github.com/juyeongnoh/gitjs/blob/main/porcelains/commit.js))
  - ìŠ¤í…Œì´ì§• ì˜ì—­ì— ì €ì¥ëœ íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ tree ì˜¤ë¸Œì íŠ¸ ìƒì„±
  - í˜„ì¬ HEADë¥¼ ì°¸ì¡°í•˜ì—¬ ë¶€ëª¨ ì»¤ë°‹ í•´ì‹œ íŒë³„
  - ìƒì„±ëœ tree ì˜¤ë¸Œì íŠ¸ë¡œ ìƒˆë¡œìš´ commit ì˜¤ë¸Œì íŠ¸ ìƒì„±
  - `.git/refs/heads` ì—…ë°ì´íŠ¸ ë¡œì§
- branch ëª…ë ¹ì–´ ([/porcelains/branch.js](https://github.com/juyeongnoh/gitjs/blob/main/porcelains/branch.js))
  - ë¸Œëœì¹˜ ì¡°íšŒ
    - `.git/refs/heads/`ì— ì €ì¥ë˜ì–´ ìˆëŠ” íŒŒì¼ ëª©ë¡ì„ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
    - í˜„ì¬ ë¸Œëœì¹˜ëŠ” ë¸Œëœì¹˜ëª… ì•ì— `*` í‘œì‹œ
  - ë¸Œëœì¹˜ ìƒì„±
    - `.git/refs/heads/{ë¸Œëœì¹˜ëª…}` íŒŒì¼ ì¶”ê°€
    - í˜„ì¬ ë¸Œëœì¹˜ì˜ HEAD (ë§ˆì§€ë§‰ ì»¤ë°‹ í•´ì‹œ) ë³µì‚¬í•˜ì—¬ ì €ì¥
  - ë¸Œëœì¹˜ëª… ë³€ê²½
    - `.git/refs/heads/{ë¸Œëœì¹˜ëª…}` ì´ë¦„ ë³€ê²½
    - í˜„ì¬ HEADê°€ ì‹¬ë³¼ë¦­ ì°¸ì¡°ê°€ ì•„ë‹Œ ì¼ë°˜ ì»¤ë°‹ì¸ ê²½ìš° ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
  - ë¸Œëœì¹˜ ì‚­ì œ
    - í˜„ì¬ ë¸Œëœì¹˜ì˜ ì¡°ìƒ ì»¤ë°‹ì„ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•˜ë©° ì‚­ì œí•˜ë ¤ëŠ” ë¸Œëœì¹˜ì˜ ì»¤ë°‹ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ì‚­ì œí•˜ë ¤ëŠ” ë¸Œëœì¹˜ê°€ ë³‘í•©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •)
    - `.git/refs/heads/{ë¸Œëœì¹˜ëª…}` ì‚­ì œ

### Plumbings (ë‚´ë¶€ ë¡œì§)

- git object ìƒì„± í•¨ìˆ˜ ([/plumbings/hashObject.js](https://github.com/juyeongnoh/gitjs/blob/main/plumbings/hashObject.js))
  - íŒŒì¼ì˜ byteLength ê°’ ê³„ì‚°í•˜ì—¬ í—¤ë” ì¶”ê°€
  - zlib ì••ì¶• ë° SHA í•´ì‹œ ìƒì„±

### ìë£Œêµ¬ì¡°

- Entry í´ë˜ìŠ¤ ([/types/Entry.js](https://github.com/juyeongnoh/gitjs/blob/main/types/Entry.js))
  - File Stats ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìŠ¤í…Œì´ì§• ì˜ì—­ì— ê¸°ë¡í•  íŒŒì¼ ì—”íŠ¸ë¦¬ ìƒì„±
  - ctime, mtimeì˜ ë‚˜ë…¸ì´ˆ ì •ë°€ë„ ê¸°ë¡ ë³´ì¥
  - Bufferë¡œ ë³€í™˜ ê¸°ëŠ¥
- Index í´ë˜ìŠ¤ ([/types/Index.js](https://github.com/juyeongnoh/gitjs/blob/main/types/Index.js))
  - Index ë²„ì „ 2ë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬í˜„
  - Entry ì¶”ê°€ ê¸°ëŠ¥
  - SHA ì²´í¬ì„¬ ì—°ì‚° ê¸°ëŠ¥
  - Bufferë¡œ ë³€í™˜ ê¸°ëŠ¥
- Tree ì˜¤ë¸Œì íŠ¸ í´ë˜ìŠ¤ ([/types/Tree.js](https://github.com/juyeongnoh/gitjs/blob/main/types/Tree.js))
  - Index Entry ì¶”ê°€ ì‹œ ì¬ê·€ì ìœ¼ë¡œ JS Object ê¸°ë°˜ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
  - Bufferë¡œ ë³€í™˜ ê¸°ëŠ¥
- Commit ì˜¤ë¸Œì íŠ¸ í´ë˜ìŠ¤ ([/types/Commit.js](https://github.com/juyeongnoh/gitjs/blob/main/types/Commit.js))
  - Bufferë¡œ ë³€í™˜ ê¸°ëŠ¥

## ğŸ“š ë°°ìš´ ì 

### SHA í•´ì‹œ ê¸°ë°˜ íŒŒì¼ ê´€ë¦¬ì˜ ì´ì 

- test.txtë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ì™€ ê°™ì€ íŒŒì¼ì„ ì €ì¥í•œë‹¤ê³  ê°€ì •í•˜ë©´

  ```
  Hello world!
  ```

- git ì €ì¥ì†Œì— ì•„ë˜ì™€ ê°™ì´ ì €ì¥ëœë‹¤.

  | Key    | Value        |
  | ------ | ------------ |
  | 7a6dce | Hello world! |

- í•˜ì§€ë§Œ í•œê¸€ìë¼ë„ ìˆ˜ì •í•˜ê²Œ ëœë‹¤ë©´

  ```
  Hello world~
  ```

- ëˆˆì‚¬íƒœ íš¨ê³¼ì— ì˜í•´ í•´ì‹œê°’ì´ í¬ê²Œ ë°”ë€Œì–´ ê¸°ì¡´ ë°ì´í„°ì™€ ë³„ë„ë¡œ ì €ì¥ë˜ê²Œ ëœë‹¤.

  | Key    | Value        |
  | ------ | ------------ |
  | 7a6dce | Hello world! |
  | 2b785f | Hello world~ |

- gitì—ì„œëŠ” íŒŒì¼(blob), ë””ë ‰í† ë¦¬(tree), ì»¤ë°‹(commit)ì„ ëª¨ë‘ SHA í•´ì‹œí•˜ì—¬ ê´€ë¦¬í•œë‹¤.
  ```mermaid
  graph LR
    Commit["Commit[ab78e]: my-commit"] -->|tree| Tree1["Tree[d4fe5]: /"]
    Tree1 -->|tree| Tree2["Tree[8cea1]: src"]
    Tree2 -->|blob| Blob1["Blob[b4d1a]: main.js"]
    Tree1 -->|blob| Blob2["Blob[118ce]: README.md"]
  ```
- ì´ ë°©ì‹ì˜ ì´ì ì€ ì´ì „ì˜ ì—°ì‚°í•œ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
- í…ìŠ¤íŠ¸ íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ë‹¤ì‹œ "Hello world!"ë¡œ ëŒì•„ê°€ë”ë¼ë„ ì´ë¯¸ ì´ì „ì— ì—°ì‚°í•œ í•´ì‹œê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì €ì¥ì†Œë¥¼ ë¹„êµì  ê°€ë³ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

### gitì— `.env`ì²˜ëŸ¼ ë¯¼ê°í•œ íŒŒì¼ì„ ì €ì¥í•˜ë©´ ì•ˆë˜ëŠ” ì´ìœ 

- `git add íŒŒì¼ëª…`ì„ í„°ë¯¸ë„ì— ì…ë ¥í•˜ëŠ” ìˆœê°„ íŒŒì¼ì´ ì••ì¶•ë˜ì–´ `.git/objects/`ì— ì €ì¥ëœë‹¤.
- add ì‘ì—…ì„ ì·¨ì†Œí•œë‹¤ê³  í•˜ë”ë¼ë„ í•œë²ˆ ì €ì¥ëœ íŒŒì¼ì´ ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤.
- ì¶”í›„ Garbage Collectionì— ì˜í•´ ìë™ ì‚­ì œë  ì—¬ì§€ê°€ ìˆì§€ë§Œ í•´ì‹œê°’ì´ ì–´ë”˜ê°€ì—ì„œ ì°¸ì¡°ë˜ê³  ìˆë‹¤ë©´ ì˜êµ¬ì ìœ¼ë¡œ ë°•ì œë˜ëŠ” ê²ƒì´ë‚˜ ë‹¤ë¦„ì—†ë‹¤.
- ê·¸ëŸ¬ë‹ˆ ë¯¼ê°í•œ ìë£ŒëŠ” ì ˆëŒ€ gitì— ì €ì¥í•˜ë©´ ì•ˆëœë‹¤. (ì›ê²© ì €ì¥ì†Œì— push í•˜ëŠ” ê²½ìš°)

### gitì´ íŒŒì¼ì„ ë‹¤ë£¨ëŠ” ë°©ì‹

- git ì €ì¥ì†ŒëŠ” SHAë¥¼ í‚¤ ê°’ìœ¼ë¡œ ê°–ëŠ” Key-Value ìë£Œêµ¬ì¡°ì´ë‹¤.
- ê·¸ Keyë“¤ì„ í¬ì¸í„°ë¡œ ì—°ê²°í•˜ì—¬ ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” ê·¸ë˜í”„ë¥¼ ë§Œë“ ë‹¤.
- ìƒˆë¡œìš´ ì»¤ë°‹ì„ ë§Œë“¤ ë•Œ, ì´ì „ ì»¤ë°‹ì— í˜„ì¬ ì»¤ë°‹ í•´ì‹œë¥¼ ìë…€ ë…¸ë“œë¡œ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì´ì „ ì»¤ë°‹ í•´ì‹œë¥¼ í˜„ì¬ ì»¤ë°‹ì— ë¶€ëª¨ ë…¸ë“œë¡œ ë“±ë¡í•œë‹¤.

### gitì˜ ìµœì í™”

- `git status`ë¥¼ ì…ë ¥í•˜ë©´ ì‘ì—… ì˜ì—­ì— ìˆëŠ” íŒŒì¼ê³¼ gitì— ì €ì¥ëœ íŒŒì¼ì˜ ì°¨ì´ë¥¼ ëˆˆê¹œì§í•  ì‚¬ì´ì— ë³´ì—¬ì¤€ë‹¤.
- ì´ê²ƒì€ gitì´ íŒŒì¼ì˜ ë‚´ìš©ì„ ì§ì ‘ ë¹„êµí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•œ ì¼ì´ë‹¤. (êµ‰ì¥íˆ ë¹„ì‹¼ ì—°ì‚°ì´ë‹¤)
- ìŠ¤í…Œì´ì§• ì˜ì—­(Index)ì— íŒŒì¼ì„ ê¸°ë¡í•  ë•Œ íŒŒì¼ì˜ ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°ì¸ mtimeì„ ë‚˜ë…¸ì´ˆ ë‹¨ìœ„ê¹Œì§€ ê¸°ë¡í•˜ëŠ”ë°, ì´ ê°’ì„ í˜„ì¬ íŒŒì¼ì˜ Statsê³¼ ëŒ€ì¡°í•˜ê¸° ë•Œë¬¸ì— êµ³ì´ ë¹„ì‹¼ ì—°ì‚°ì„ í•  í•„ìš”ê°€ ì—†ë‹¤.

### .git/objects ë””ë ‰í† ë¦¬ ì•ˆì— ë°”ë¡œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥í•˜ì§€ ì•ŠëŠ” ì´ìœ 

- .gitì—ì„œ ê´€ë¦¬ë˜ëŠ” ëª¨ë“  ì˜¤ë¸Œì íŠ¸ë“¤ì€ 40ì ê¸¸ì´ì˜ SHA í•´ì‹œê°’ìœ¼ë¡œ ì €ì¥ëœë‹¤.
- í•˜ì§€ë§Œ,
  - `.git/objects/0b8f46cff781c078336473ad3ec6fe275ad6e596` ì²˜ëŸ¼ ë°”ë¡œ ì €ì¥ë˜ì§€ ì•Šê³ 
  - `.git/objects/0b/8f46cff781c078336473ad3ec6fe275ad6e596` ì²˜ëŸ¼ 2ì, 38ì ëŠì–´ì„œ ì €ì¥ëœë‹¤.
- ì´ëŠ” êµ¬í˜• íŒŒì¼ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ì„¤ê³„ëœ ê²ƒì´ë‹¤.
- FAT32 íŒŒì¼ ì‹œìŠ¤í…œì—ì„œëŠ” í•œ í´ë” ì•ˆì— íŒŒì¼ ê°œìˆ˜ê°€ 2^14(16,384)ê°œë¡œ ì œí•œëœë‹¤.
- ê·¸ë ‡ê¸° ë•Œë¬¸ì—, í•´ì‹œë¥¼ 2ì, 38ìë¡œ ëŠì–´ì„œ ì €ì¥í•˜ë©´ ìµœëŒ€ 4,177,920ê°œì˜ ì˜¤ë¸Œì íŠ¸ê¹Œì§€ ì €ì¥í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
- (2ìë¡œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” 16ì§„ìˆ˜ ë²”ìœ„(00 ~ FF => 255) \* 2^14 = 4,177,920)

## âœ¨ ê°„í¸í•œ ë””ë²„ê¹…ì„ ìœ„í•œ vscode ìµìŠ¤í…ì…˜ êµ¬í˜„

- git objectëŠ” zlibìœ¼ë¡œ ì••ì¶•ëœ ë°ì´í„°ì´ê¸° ë•Œë¬¸ì— ë‚´ìš©ì„ ì—´ëŒí•˜ë ¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì•¼í•œë‹¤.
  - `git cat-file -p 020a23`
- í•˜ì§€ë§Œ í•´ì‹œê°’ì„ ì¼ì¼ì´ ì…ë ¥í•´ê°€ë©° ì—´ëŒí•˜ë‹¤ ë³´ë‹ˆ ê°œë°œ ìƒì‚°ì„±ì´ ë–¨ì–´ì§€ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.
- ì§ì ‘ ë§Œë“  ì˜¤ë¸Œì íŠ¸ì˜ ë‚´ìš©ì„ ì‹¤ì œ gitê³¼ ë¹„êµí•˜ê³  ì‹¶ì€ë°, ì´ëŸ¬í•œ ì  ë•Œë¬¸ì— êµ¬í˜„ì— ë§ì€ ì‹œê°„ì´ ë“¤ì—ˆë‹¤.
- ê·¸ë˜ì„œ git objectë¥¼ ë§Œë“œëŠ” ë¡œì§ì„ AIì—ê²Œ ë„˜ê²¨ì£¼ì–´ vscode ìƒì—ì„œ ë°”ë¡œ ì½ì„ ìˆ˜ ìˆëŠ” ìµìŠ¤í…ì…˜ì„ ë§Œë“¤ì–´ì„œ ì‘ì—…í–ˆë‹¤.
- ìµìŠ¤í…ì…˜: https://marketplace.visualstudio.com/items?itemName=JamesNoh.git-objects-viewer

  ![git-object-vscode-extension](https://github.com/user-attachments/assets/2eab2d44-81d5-478b-8b35-e01323ddb62a)

## âš’ï¸ ì–´ë ¤ì› ë˜ ì 

### Buffer ìë£Œêµ¬ì¡°ë¥¼ í†µí•œ ë¹„íŠ¸ ë‹¨ìœ„ ë°ì´í„° ê´€ë¦¬

- Index íŒŒì¼ì²˜ëŸ¼ ìˆœìˆ˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì²˜ìŒ í•¸ë“¤ë§í•´ë´ì„œ ì–´ë ¤ì› ë‹¤.
- íŠ¹íˆ, ê° ì—”íŠ¸ë¦¬ì˜ mode í•„ë“œì²˜ëŸ¼ ë¹„íŠ¸ ë‹¨ìœ„ì˜ ê°’ì´ í¬í•¨ëœ ê²½ìš° ì‰¬í”„íŠ¸ ì—°ì‚°ìë¥¼ ì´ìš©í•´ ë°€ê³ , ê°’ì„ ë¼ì›Œë„£ê³  í•˜ëŠ” ì‘ì—…ì´ ê¹Œë‹¤ë¡œì› ë‹¤.
  ```js
  // types/Entry.js
  // 4ë°”ì´íŠ¸ ì•ˆì—ì„œ 4ë¹„íŠ¸ëŠ” ì˜¤ë¸Œì íŠ¸ íƒ€ì…, 3ë¹„íŠ¸ëŠ” ê³µë°±, 9ë¹„íŠ¸ëŠ” ìœ ë‹‰ìŠ¤ ê¶Œí•œ ì˜ì—­ìœ¼ë¡œ í• ë‹¹ëœë‹¤.
  const modeBuffer = Buffer.alloc(4);
  let entryTypeAndUnused;
  if (this.entryType === "REGULAR_FILE") {
    entryTypeAndUnused = 0b1000;
  } else if (this.entryType === "SYMLINK") {
    entryTypeAndUnused = 0b1010;
  } else if (this.entryType === "GITLINK") {
    entryTypeAndUnused = 0b1110;
  }
  entryTypeAndUnused = entryTypeAndUnused << 12;
  modeBuffer.writeUInt32BE(entryTypeAndUnused | this.filePermission);
  ```

## âŒ í•œê³„ ë° ë¯¸êµ¬í˜„

- ì„±ëŠ¥ ìµœì í™”(commit-graph ë“±)ëŠ” ê³ ë ¤ë˜ì§€ ì•ŠìŒ.
- Merge, Reset, GC, ì›ê²© ì €ì¥ì†Œ ëŒ€ì‘ ë“± ë³µì¡í•œ ê¸°ëŠ¥ì€ êµ¬í˜„ë˜ì§€ ì•ŠìŒ.
